<div class="flex justify-between items-center mb-6">
  <input
    matInput
    (keyup)="applyFilter($event)"
    placeholder="Search records"
    #input
    class="px-4 py-2 border rounded-lg shadow-sm flex-grow mr-4"
  />
  <!-- Add Record Button -->
  <button
    class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition duration-300"
    (click)="openAddUserForm()"
  >
    Add Record
  </button>
</div>

<!-- Add User Form -->
<div *ngIf="isAddFormVisible" class="mb-4">
  <form [formGroup]="addUserForm" (ngSubmit)="onSubmit()">
    <div class="mb-2">
      <label for="name" class="block text-sm font-medium text-gray-700"
        >Name</label
      >
      <input
        formControlName="name"
        id="name"
        type="text"
        class="mt-1 p-2 border rounded-lg"
      />
    </div>
    <div class="mb-2">
      <label
        for="departmentType"
        class="block text-sm font-medium text-gray-700"
        >Department Type</label
      >
      <input
        formControlName="departmentType"
        id="departmentType"
        type="text"
        class="mt-1 p-2 border rounded-lg"
      />
    </div>
    <div class="mb-2">
      <label for="startYear" class="block text-sm font-medium text-gray-700"
        >Start Year</label
      >
      <input
        formControlName="startYear"
        id="startYear"
        type="number"
        class="mt-1 p-2 border rounded-lg"
      />
    </div>
    <div class="mb-2">
      <label for="endYear" class="block text-sm font-medium text-gray-700"
        >End Year</label
      >
      <input
        formControlName="endYear"
        id="endYear"
        type="number"
        class="mt-1 p-2 border rounded-lg"
      />
    </div>
    <!-- Add Competencies -->
    <div class="mb-2">
      <label for="competencies" class="block text-sm font-medium text-gray-700"
        >Competencies (ID)</label
      >
      <input
        formControlName="competencies"
        id="competencies"
        type="text"
        class="mt-1 p-2 border rounded-lg"
        placeholder="Enter competency ID"
      />
    </div>
    <!-- Add Goals -->
    <div class="mb-2">
      <label for="goals" class="block text-sm font-medium text-gray-700"
        >Goals</label
      >
      <input
        formControlName="goals"
        id="goals"
        type="text"
        class="mt-1 p-2 border rounded-lg"
        placeholder="Enter goal details"
      />
    </div>

    <button
      type="submit"
      class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600"
    >
      Add Record
    </button>
  </form>
</div>

<!-- Edit Form -->
<div *ngIf="isEditFormVisible" class="bg-white p-6 rounded-lg shadow-md max-w-xl mx-auto">
  <h3 class="text-2xl font-semibold mb-4 text-gray-800">Edit Performance Review</h3>
  <form [formGroup]="editUserForm" (ngSubmit)="onEditSubmit()">
    <!-- Name Field -->
    <div class="mb-4">
      <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
      <input
        type="text"
        id="name"
        formControlName="name"
        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
        placeholder="Enter name"
      />
      <div
        *ngIf="
          editUserForm.get('name')?.invalid &&
          editUserForm.get('name')?.touched
        "
        class="text-red-500 text-sm mt-1"
      >
        Name is required.
      </div>
    </div>

    <!-- Department Type Field -->
    <div class="mb-4">
      <label for="departmentType" class="block text-sm font-medium text-gray-700">Department Type</label>
      <input
        type="text"
        id="departmentType"
        formControlName="departmentType"
        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
        placeholder="Enter department type"
      />
      <div
        *ngIf="
          editUserForm.get('departmentType')?.invalid &&
          editUserForm.get('departmentType')?.touched
        "
        class="text-red-500 text-sm mt-1"
      >
        Department Type is required.
      </div>
    </div>

    <!-- Start Year Field -->
    <div class="mb-4">
      <label for="startYear" class="block text-sm font-medium text-gray-700">Start Year</label>
      <input
        type="number"
        id="startYear"
        formControlName="startYear"
        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
        placeholder="Enter start year"
      />
      <div
        *ngIf="
          editUserForm.get('startYear')?.invalid &&
          editUserForm.get('startYear')?.touched
        "
        class="text-red-500 text-sm mt-1"
      >
        Start Year is required.
      </div>
    </div>

    <!-- End Year Field -->
    <div class="mb-4">
      <label for="endYear" class="block text-sm font-medium text-gray-700">End Year</label>
      <input
        type="number"
        id="endYear"
        formControlName="endYear"
        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
        placeholder="Enter end year"
      />
      <div
        *ngIf="
          editUserForm.get('endYear')?.invalid &&
          editUserForm.get('endYear')?.touched
        "
        class="text-red-500 text-sm mt-1"
      >
        End Year is required.
      </div>
    </div>

    <!-- Competencies Field -->
    <div class="mb-4">
      <label for="competencies" class="block text-sm font-medium text-gray-700">Competencies</label>
      <select
        id="competencies"
        formControlName="competencies"
        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
      >
        <option *ngFor="let competency of competencies" [value]="competency.id">
          {{ competency.name }}
        </option>
      </select>
      <div
        *ngIf="
          editUserForm.get('competencies')?.invalid &&
          editUserForm.get('competencies')?.touched
        "
        class="text-red-500 text-sm mt-1"
      >
        Competencies are required.
      </div>
    </div>

    <!-- Goals Field -->
    <div class="mb-4">
      <label for="goals" class="block text-sm font-medium text-gray-700">Goals</label>
      <textarea
        id="goals"
        formControlName="goals"
        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
        placeholder="Enter goals"
      ></textarea>
      <div
        *ngIf="
          editUserForm.get('goals')?.invalid &&
          editUserForm.get('goals')?.touched
        "
        class="text-red-500 text-sm mt-1"
      >
        Goals are required.
      </div>
    </div>

    <!-- Submit Button -->
    <div class="flex space-x-4">
      <button
        type="submit"
        class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 disabled:opacity-50"
        [disabled]="editUserForm.invalid"
      >
        Save Changes
      </button>

      <!-- Cancel Button -->
      <button
        type="button"
        class="bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400"
        (click)="cancelEdit()"
      >
        Cancel
      </button>
    </div>
  </form>
</div>

<div class="overflow-x-auto bg-white rounded-lg shadow-lg">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th
          *ngFor="let header of headers"
          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
        >
          {{ header }}
        </th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      <tr *ngFor="let record of performanceReviews">
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
          {{ record.id }}
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
          {{ record.departmentType }}
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
          {{ record.startYear }} - {{ record.endYear }}
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
          {{ record.startDate }}
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
          {{ record.endDate }}
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
          {{ record.name }}
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
          {{ record.supervisorId }}
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
          <button class="text-indigo-600 hover:text-indigo-900 mr-3" (click)="openEditForm(record)">
            <i-lucide [img]="Edit" class="w-5 h-5" ></i-lucide>
          </button>
          <button
            class="text-red-600 hover:text-red-900"
            (click)="deleteRecord(record.id)"
          >
            <i-lucide [img]="Trash" class="w-5 h-5"></i-lucide>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
  <div class="p-6">
    <button
      (click)="openDialog()"
      class="px-4 py-2 bg-blue-500 rounded-md text-white hover:bg-blue-600"
    >
      Open Dialog
    </button>
  </div>
  <app-add-performance-review
    *ngIf="isDialogOpen"
    (close)="closeDialog()"
  />
</div>
